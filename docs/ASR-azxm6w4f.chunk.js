import{u as H}from"./index-hf0ppsqy.chunk.js";import{x as U}from"./index-c035twz6.chunk.js";import{z as L}from"./index-089q88sw.chunk.js";import{F as M,I as $,J as q,N as x,P as G}from"./index-e5yfbe8q.chunk.js";import{Q as b}from"./index-4qzys2m0.chunk.js";import{$ as p,aa as T,ba as v,ca as jsxDEV,ea as B}from"./index-0pwdr63a.chunk.js";import"./index-5ztkcgcw.chunk.js";import"./index-m6gkxxm7.chunk.js";import"./index-wtr7p5sj.chunk.js";var I=window.SpeechRecognition||window.webkitSpeechRecognition;class S{_recognition;_isPermissionGranted=!1;_isListening=!1;get isListening(){return this._isListening}async requestPermission(){if(this._isPermissionGranted)return;let o=await navigator.mediaDevices.getUserMedia({audio:!0});this._isPermissionGranted=o.active}recognize(o="id-ID"){if(this.isListening)throw Error("listening");if(!this._recognition)this._recognition=new I;this._recognition.lang=o,this._recognition.interimResults=!0,this._recognition.continuous=!0,this._recognition.maxAlternatives=1;let i;return new Promise((a,c)=>{try{this._recognition.onresult=(t)=>{i=t.results},this._recognition.onerror=(t)=>{this._isListening=!1,c(t.error)},this._recognition.onnomatch=(t)=>{if(this._isListening)this._recognition?.start()},this._recognition.onend=()=>{if(this._isListening)this._recognition?.start();else{let t="";if(i)t=Array.from(i).map((e)=>e[0].transcript).join(" ");a(t)}},this._recognition.start(),this._isListening=!0}catch(t){c(t)}})}recognize2(o="id-ID"){if(this.isListening)throw Error("listening");if(!this._recognition)this._recognition=new I;this._recognition.lang=o,this._recognition.interimResults=!1,this._recognition.continuous=!0,this._recognition.maxAlternatives=1;let i;return new Promise((c,t)=>{try{this._recognition.onresult=(e)=>{i=e.results},this._recognition.onerror=(e)=>{this._isListening=!1,t(e.error)},this._recognition.onnomatch=(e)=>{if(this._isListening)this._recognition?.start()},this._recognition.onend=()=>{if(this._isListening)this._recognition?.start();else{let e="";if(i)e=Array.from(i).map((g)=>g[0].transcript).join(" ");c(e)}},this._recognition.start(),this._isListening=!0}catch(e){t(e)}})}stop(){if(this._isListening=!1,!this._recognition)return;this._recognition.stop()}}var m=void 0;function Q(){let o=v(null),[,,i]=B(),a=v(null),[c,t]=p(!1),[e,g]=p(!1),[w,A]=p(!1),l=v(!1),[u,N]=p("");T(()=>{let n,r,s,h,f;return navigator.mediaDevices.getUserMedia({audio:!0}).then(async(R)=>{m=new S,n=new(window.AudioContext||window.webkitAudioContext),h=n.createMediaStreamSource(R),r=n.createAnalyser(),r.fftSize=512;let O=r.fftSize;s=new Uint8Array(O),h.connect(r);let J=0.02,K=(d)=>{let k=0;for(let y=0;y<d.length;y++){let z=(d[y]-128)/128;k+=z*z}return Math.sqrt(k/d.length)>J},_=!0,C=o.current.transferControlToOffscreen(),P=await new U.canvas.AudioVisual(L(C,[C]));a.current=(d)=>{if(!d){if(typeof f!=="number")return;clearInterval(f),f=void 0;return}if(typeof f==="number")return;f=setInterval(()=>{if(r.getByteTimeDomainData(s),K(s))_=!1,P.draw(L(s,[s.buffer]));else if(!_)_=!0,P.drawSilent()},66.66666666666667)},t(!0)}).catch((R)=>{alert("Microphone access denied or unavailable.")}),()=>{if(clearInterval(f),n)n.close()}},[]);let W=async()=>{if(!c)return;if(i(),e&&!w){m.stop();return}try{let n=m.recognize();g(!0),A(!1),a.current?.(!0);let r=await n;if(!r&&!l.current)return;let s=H(r);if(!s&&!l.current)return;let h=u+s+"+";if(l.current)l.current=!1,document.startViewTransition(()=>b(`/check?data=${encodeURIComponent(h)}`));else N(h)}catch(n){alert(n)}finally{a.current?.(),A(!0)}},X=()=>{if(!e)return;if(i(),l.current=!0,m.stop(),a.current?.(),g(!1),w)l.current=!1,document.startViewTransition(()=>b(`/check?data=${encodeURIComponent(u)}`))},F=()=>{i(),document.startViewTransition(()=>{b("/")})};return jsxDEV("div",{style:{height:"100dvh",width:"100dvw",position:"relative",viewTransitionName:"view-scale"},children:[jsxDEV("canvas",{ref:o,width:window.innerWidth,height:window.innerHeight/2,style:{position:"absolute",left:0,top:0,border:"none",background:"transparent",width:"100%",height:"50%"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"fixed",top:"40%",left:"0",width:"100%",height:"60%",fontSize:"1rem",padding:"0.5rem 1rem",textAlign:"center"},children:u},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"fixed",top:"40%",left:"0",width:"100%",height:"50%",background:"linear-gradient(to top, #fff, #ffff)"}},void 0,!1,void 0,this),e&&jsxDEV("button",{class:"float-btn",style:{position:"absolute",left:"15%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"2rem",transform:"translate(-50%,-25%)",transition:"opacity 0.3s ease"},onClick:F,children:jsxDEV(G,{},void 0,!1,void 0,this)},void 0,!1,void 0,this),jsxDEV("button",{class:"float-btn",disabled:!c,style:{position:"absolute",left:"50%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"3rem",color:"#f44336",transform:"translateX(-50%)",transition:"opacity 0.3s ease"},onClick:W,children:!e?jsxDEV(M,{fill:"#f44336"},void 0,!1,void 0,this):w?jsxDEV(q,{fill:"#f44336"},void 0,!1,void 0,this):jsxDEV($,{fill:"#f44336"},void 0,!1,void 0,this)},void 0,!1,void 0,this),e&&jsxDEV("button",{class:"float-btn",disabled:!u,style:{position:"absolute",right:"15%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"2rem",color:!u?"#ccc":"#f44336",transform:"translate(50%,-25%)",transition:"opacity 0.3s ease"},onClick:X,children:jsxDEV(x,{fill:!u?"#ccc":"#f44336"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)}export{Q as default};
