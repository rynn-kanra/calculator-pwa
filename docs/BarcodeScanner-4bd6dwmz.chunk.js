import{x as O}from"./index-c035twz6.chunk.js";import{z as P}from"./index-089q88sw.chunk.js";import{$ as w,aa as v,ba as T,ca as jsxDEV,ea as o}from"./index-0pwdr63a.chunk.js";import{fa as y}from"./index-5ztkcgcw.chunk.js";import"./index-m6gkxxm7.chunk.js";import"./index-a2ag3cbv.chunk.js";function f(t){let i={value:t};if(!t.startsWith("]"))return i;let c=t.substring(0,3);switch(i.value=t.substring(3),i.aim={symbology:c[1],modifier:c[2]},i.aim.symbology){case"A":{i.aim.format="code_39";break}case"C":{i.aim.format="code_128";break}case"E":{switch(t.length){case 13:{i.aim.format="ean_13";break}case 12:{i.aim.format="upc_a";break}case 8:{i.aim.format=i.aim.modifier==="4"?"ean_8":"upc_e";break}}break}case"F":{i.aim.format="codabar";break}case"G":{i.aim.format="code_93";break}case"I":{i.aim.format="itf";break}case"L":{i.aim.format="pdf417";break}case"Q":{i.aim.format="qr_code";break}case"d":{i.aim.format="data_matrix";break}case"z":{i.aim.format="aztec-code";break}}return i}var n=()=>{let t,i,c=new Promise((d,e)=>{t=d,i=e});return c.resolve=t,c.reject=i,c};var H={Enter:`
`,Tab:"\t","Escape:":"\x1B"};class B{#t;#r=!1;constructor(t){this.#t=y(t,{target:document.body,timeout:60,buffer:"",first:0,last:0}),this.keydown=this.keydown.bind(this)}async init(t){this.connect()}async connect(){if(this.#r)return;this.#t.target.addEventListener("keydown",this.keydown),this.#r=!0}async disconnect(){if(!this.#r)return;this.#t.target.removeEventListener("keydown",this.keydown),this.#r=!1,this.#t.defer?.reject("disconnected")}async dispose(){this.disconnect();return}async*[Symbol.asyncIterator](){if(!this.#t.defer)this.#t.defer=n();try{while(!0)yield await this.#t.defer,this.#t.defer=n()}catch{this.#t.defer=void 0}finally{}}keydown(t){if(t.target?.tagName==="INPUT"||t.target.tagName==="TEXTAREA"){this.clear();return}if(t.key==="Clear"&&t.code==="NumLock"){this.clear();return}if(t.ctrlKey&&!this.#t.buffer){this.clear();return}let i=Date.now();if((this.#t.first?i-this.#t.last:0)>this.#t.timeout)this.clear(),this.#t.first=0;if(this.#t.last=i,!this.#t.first)this.#t.first=this.#t.last;else t.stopPropagation(),t.preventDefault();let d=t.key;if(t.key.length===1){if(t.ctrlKey){let e=t.key.toUpperCase().charCodeAt(0)-64;d=String.fromCharCode(e)}else if(t.shiftKey)d=d.toLocaleUpperCase()}else{let e=H[t.key];if(e)d=e;else return}if(this.#t.buffer+=d,d===`
`){let e=void 0,m=this.#t.buffer.substring(0,this.#t.buffer.length-1);while(m.endsWith("\r")||m.endsWith("\t"))m=m.slice(0,-1);let h=f(m);if(h.aim)m=h.value,e=h.aim.format;this.#t.defer?.resolve({rawValue:this.#t.buffer,value:m,format:e}),this.clear();return}}clear(){this.#t.buffer="",this.#t.first=this.#t.last=0}}class I{#t;#r=!1;constructor(t){this.#t=y(t,{box:{height:100,width:100,x:0,y:0}})}async init(t){if(this.#t.detector)return;if(!("BarcodeDetector"in window))alert("BarcodeDetector is not supported.");this.#t.detector=await new O.canvas.BarcodeScanner;try{this.#t.video.pause();var i=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",zoom:{ideal:1},focusMode:"continuous"}});this.#t.video.srcObject=i}catch(c){}}async connect(){if(this.#r)return;await this.init(),this.#t.video.play(),clearTimeout(this.#t.detectTOId),this.#t.detectAnimateId&&cancelAnimationFrame(this.#t.detectAnimateId),this.#t.detectTOId=setTimeout(()=>{this.#t.detectAnimateId=requestAnimationFrame(()=>this.detectBarcode())},300),this.#r=!0}async disconnect(){if(!this.#r)return;this.#t.video.pause(),clearTimeout(this.#t.detectTOId),this.#t.detectAnimateId&&cancelAnimationFrame(this.#t.detectAnimateId),this.#r=!1}async dispose(){if(this.disconnect(),this.#t.video?.srcObject instanceof MediaStream)this.#t.video.srcObject.getTracks().forEach((t)=>t.stop()),this.#t.video.srcObject=null;this.#t.defer?.reject("disconnected")}async*[Symbol.asyncIterator](){if(!this.#r)return;if(!this.#t.defer)this.#t.defer=n();try{while(!0)yield await this.#t.defer,this.#t.defer=n()}catch{this.#t.defer=void 0}finally{}}async detectBarcode(){try{let t=this.#t.video,i=await createImageBitmap(t);i=P(i,[i]);let c=t.getBoundingClientRect(),d=c.width/c.height,e=await this.#t.detector?.detect(i,this.#t.box,d);if(e?.rawValue)this.#t.defer?.resolve({rawValue:e.rawValue,value:e.rawValue,format:e.format})}catch(t){alert(t)}finally{clearTimeout(this.#t.detectTOId),this.#t.detectAnimateId&&cancelAnimationFrame(this.#t.detectAnimateId),this.#t.detectTOId=setTimeout(()=>{this.#t.detectAnimateId=requestAnimationFrame(()=>this.detectBarcode())},300)}}}var M=()=>{let t=T(null),i=T(null),c=T(null),[d,e]=w(),[m,h]=w(!1),[F,,A]=o(),r={x:0.1,y:0.1,width:0.8,height:0.8},s=0;if(window.innerWidth<window.innerHeight)s=window.innerWidth*r.width,r.height=Math.round(s*100/window.innerHeight)/100,r.y=(1-r.height)/2;else if(window.innerWidth>window.innerHeight)s=window.innerHeight*r.height,r.width=Math.round(s*100/window.innerWidth)/100,r.x=(1-r.width)/2;else s=window.innerWidth*r.width;r.y=r.y*0.5,v(()=>{switch(F.barcodeScannerEngine){case 1:{c.current=new B({target:document.body});break}case 0:default:c.current=new I({video:t.current,box:r})}return c.current.connect().then(()=>{h(!0),(async()=>{for await(let q of c.current)A(),c.current?.disconnect(),e(q),i.current?.showModal(),h(!1)})()}),()=>{c.current?.dispose()}},[]),v(()=>{if(t.current)t.current.addEventListener("pause",function(){this.style.filter="blur(5px)"}),t.current.addEventListener("play",function(){this.style.filter=""})},[t]);let W=()=>{A(),c.current?.connect(),i.current?.close(),h(!0)},a=Math.round(s/10);return jsxDEV("div",{style:{height:"100dvh",width:"100dvw",position:"relative",viewTransitionName:"view-scale"},children:[jsxDEV("video",{ref:t,autoPlay:!0,playsInline:!0,style:{width:"100%",backgroundColor:"black",height:"100%",objectFit:"cover",transition:"filter 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",background:"rgba(0, 0, 0, 0.4)",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",clipPath:`polygon(
            0% 0%, 100% 0%, 100% 100%, 0% 100%,
            0% 0%,
            ${r.x*100}% ${r.y*100}%, ${r.x*100}% ${(r.y+r.height)*100}%, ${(r.x+r.width)*100}% ${(r.y+r.height)*100}%, ${(r.x+r.width)*100}% ${r.y*100}%, ${r.x*100}% ${r.y*100}%
          )`}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${a}px`,height:`${a}px`,borderWidth:"3px",borderColor:m?"#f44336":"#666",top:`calc(${r.y*100}% - 2px)`,left:`calc(${r.x*100}% - 2px)`,borderStyle:"solid none none solid",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${a}px`,height:`${a}px`,borderWidth:"3px",borderColor:m?"#f44336":"#666",top:`calc(${r.y*100}% - 2px)`,left:`calc(${(r.x+r.width)*100}% - ${a-3+1}px)`,borderStyle:"solid solid none none",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${a}px`,height:`${a}px`,borderWidth:"3px",borderColor:m?"#f44336":"#666",top:`calc(${(r.y+r.height)*100}% - ${a-3+1}px)`,left:`calc(${(r.x+r.width)*100}% - ${a-3+1}px)`,borderStyle:"none solid solid none",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${a}px`,height:`${a}px`,borderWidth:"3px",borderColor:m?"#f44336":"#666",top:`calc(${(r.y+r.height)*100}% - ${a-3+1}px)`,left:`calc(${r.x*100}% - 2px)`,borderStyle:"none none solid solid",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("dialog",{ref:i,style:{margin:"0 auto",top:`${(r.y+r.height/4)*100}%`,maxWidth:`${(r.width-0.1)*100}%`},children:[jsxDEV("div",{children:[jsxDEV("p",{style:{margin:0,textTransform:"uppercase"},children:["FORMAT: ",d?.format]},void 0,!0,void 0,this),jsxDEV("p",{style:{margin:0,overflowWrap:"break-word"},children:d?.value},void 0,!1,void 0,this)]},void 0,!0,void 0,this),jsxDEV("div",{style:{textAlign:"right",marginTop:"1rem"},children:jsxDEV("button",{class:"btn-small",style:{color:"white",backgroundColor:"#4caf50",borderColor:"#4caf50",margin:0},onClick:W,children:"CONTINUE"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)},E=M;export{E as default};
