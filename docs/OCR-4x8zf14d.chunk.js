import{t as u}from"./index-ej4v3gd9.chunk.js";import{u as p}from"./index-hf0ppsqy.chunk.js";import{w as E}from"./index-kdxxcm80.chunk.js";import"./index-s16a94pv.chunk.js";import"./index-d5ey5pt3.chunk.js";import{F as l,H as h,P as m}from"./index-01c6y56f.chunk.js";import{Q as P}from"./index-sqv70b12.chunk.js";import{$ as k,V,aa as F,ba as y,ca as jsxDEV,ea as S}from"./index-nq6yem3r.chunk.js";import"./index-zkqt6zvr.chunk.js";import"./index-m6gkxxm7.chunk.js";import"./index-sw83f574.chunk.js";var H,d=()=>{let Q=y(null),w=y(null),$=y(null),[U,g]=k(!1),[I,z]=k(null),[b,,L]=S(),q={x:0.5,y:0.05,width:0.4,height:0.8};F(()=>{if(window.launchQueue)window.launchQueue.setConsumer(async(K)=>{if(K.files.length){let G=await K.files[0].getFile();W(G)}});switch(b.ocrEngine){case 1:{H=new u;break}case 2:default:{H=new E;break}}if(new URLSearchParams(window.location.hash.split("?")[1]).get("share"))H.init(),navigator.serviceWorker.ready.then(()=>{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({action:"handleShare"})});else navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:window.innerWidth*window.devicePixelRatio},height:{ideal:window.innerHeight*window.devicePixelRatio}}}).then((K)=>{if(Q.current)Q.current.srcObject=K,g(!0),H.init()}).catch((K)=>{});let N=(K)=>{if(K.data)switch(K.data.type){case"SHARE":{W(K.data.image);break}}};return navigator.serviceWorker.addEventListener("message",N),()=>{navigator.serviceWorker.removeEventListener("message",N),X()}},[]),F(()=>{if($.current)$.current.onchange=async()=>{if(!$.current.files)return;let J=$.current?.files[0];if(!J)return;W(J)};if(Q.current)Q.current.addEventListener("pause",function(){this.style.filter="brightness(0)"}),Q.current.addEventListener("play",function(){this.style.filter=""})},[$,Q]);let X=()=>{if(Q.current?.srcObject instanceof MediaStream)Q.current.srcObject.getTracks().forEach((J)=>J.stop()),Q.current.srcObject=null},W=async(J)=>{try{Q.current?.pause();let N=await H.recognize(J);{let Y=new Map([[/([0-9])[B&](?=[0-9])/g,"$18"],[/([0-9])[Gb](?=[0-9])/g,"$11"],[/([0-9])[iIl](?=[0-9])/g,"$11"],[/([0-9])[q](?=[0-9])/g,"$19"],[/([0-9])[oO](?=[0-9])/g,"$10"],[/([0-9])[S](?=[0-9])/ig,"$15"],[/([0-9])[Zz](?=[0-9])/g,"$12"],[/([0-9])(?=[86]*0[86]*)[860][860][860]$/g,"$1000"],[/([0-9][5])(?=[86]*0[86]*)[860][860]$/g,"$1500"],[/Rp(?= *[0-9])/g,""],[/\(([0-9. ]+)\)/g,"-$1"]]),G=new Map([[/([0-9]).?[-]$/g,"$1000"],[/[^0-9.,-](?=.*[0-9]$)/g,""],[/([^50])(?=00$)/g,"$10"]]),_=N.split(`
`).map((B)=>{B=B.replaceAll(/([0-9]) (?=[.,][0-9.,]*$)/ig,"$1");let Z=B.lastIndexOf(" ");return Z===-1?B:B.substring(Z+1)}).map((B)=>{for(let Z of Y)B=B.replaceAll(Z[0],Z[1]);if(B.length<=7)for(let Z of G)B=B.replaceAll(Z[0],Z[1]);else if(B.search(/[^0-9. -]/)>=0)return"";return B});if(_.some((B)=>B.length>3))_=_.map((B)=>B.length>3?B:"");N=_.join(" ")}let K=p(N);if(!K)throw new Error("no numbers");X(),document.startViewTransition(()=>{P(`/check?data=${encodeURIComponent(K)}`)})}catch(N){alert(N),Q.current?.play()}},R=async()=>{let J=Q.current,N=w.current;if(J&&N){L();let K=J.getBoundingClientRect(),Y=J.videoWidth/J.videoHeight,G=K.width/K.height,_,B,Z=0,O=0;if(G>Y)_=J.videoWidth,B=J.videoWidth/G,O=(J.videoHeight-B)/2;else B=J.videoHeight,_=J.videoHeight*G,Z=(J.videoWidth-_)/2;let r=_*q.x+Z,v=B*q.y+O,A=_*q.width,M=B*q.height;N.width=A,N.height=M,N.getContext("2d").drawImage(J,r,v,A,M,0,0,A,M);let D=await new Promise((x,c)=>{N.toBlob(function(j){if(j)x(j);c("no data")},"image/png")}),C=URL.createObjectURL(D);z(C),await W(D),URL.revokeObjectURL(C),z("")}},n=async()=>{if(!$.current)return;L(),$.current.value="",$.current.click()},f=()=>{L(),X(),document.startViewTransition(()=>{P("/")})},T=Math.round(Math.min(q.width*window.innerWidth,q.height*window.innerHeight)*0.1);return jsxDEV("div",{style:{height:"100dvh",width:"100dvw",position:"relative",viewTransitionName:"view-scale"},children:[jsxDEV("canvas",{ref:w,style:{display:"none"}},void 0,!1,void 0,this),jsxDEV("input",{type:"file",multiple:!1,accept:"image/*",ref:$,style:{display:"none"}},void 0,!1,void 0,this),jsxDEV("video",{ref:Q,autoPlay:!0,playsInline:!0,style:{width:"100%",backgroundColor:"black",height:"100%",objectFit:"cover",transition:"filter 0.3s ease"}},void 0,!1,void 0,this),U&&jsxDEV(V,{children:[jsxDEV("div",{style:{position:"absolute",background:"rgba(0, 0, 0, 0.4)",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",clipPath:`polygon(
            0% 0%, 100% 0%, 100% 100%, 0% 100%,
            0% 0%,
            ${q.x*100}% ${q.y*100}%, ${q.x*100}% ${(q.y+q.height)*100}%, ${(q.x+q.width)*100}% ${(q.y+q.height)*100}%, ${(q.x+q.width)*100}% ${q.y*100}%, ${q.x*100}% ${q.y*100}%
          )`}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${T}px`,height:`${T}px`,borderWidth:"3px",borderColor:"#f44336",top:`calc(${q.y*100}% - 2px)`,left:`calc(${q.x*100}% - 2px)`,borderStyle:"solid none none solid",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${T}px`,height:`${T}px`,borderWidth:"3px",borderColor:"#f44336",top:`calc(${q.y*100}% - 2px)`,left:`calc(${(q.x+q.width)*100}% - ${T-3+1}px)`,borderStyle:"solid solid none none",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${T}px`,height:`${T}px`,borderWidth:"3px",borderColor:"#f44336",top:`calc(${(q.y+q.height)*100}% - ${T-3+1}px)`,left:`calc(${(q.x+q.width)*100}% - ${T-3+1}px)`,borderStyle:"none solid solid none",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"absolute",width:`${T}px`,height:`${T}px`,borderWidth:"3px",borderColor:"#f44336",top:`calc(${(q.y+q.height)*100}% - ${T-3+1}px)`,left:`calc(${q.x*100}% - 2px)`,borderStyle:"none none solid solid",transition:"border-color 0.3s ease"}},void 0,!1,void 0,this)]},void 0,!0,void 0,this),I&&jsxDEV("div",{style:{height:"100%",position:"absolute",top:0},children:[jsxDEV("h4",{style:{textAlign:"center",margin:"0 0 1rem 0",fontSize:"1rem"},children:"Processing..."},void 0,!1,void 0,this),jsxDEV("img",{src:I,alt:"Screenshot",style:{width:"auto",height:"auto",transform:"scale(0.5,0.5)",transformOrigin:"top left"}},void 0,!1,void 0,this)]},void 0,!0,void 0,this),jsxDEV("button",{class:"float-btn",disabled:!U,style:{position:"absolute",left:"15%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"2rem",transform:"translate(-50%,-25%)",transition:"opacity 0.3s ease"},onClick:f,children:jsxDEV(m,{},void 0,!1,void 0,this)},void 0,!1,void 0,this),jsxDEV("button",{class:"float-btn",disabled:!U,style:{position:"absolute",left:"50%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"3rem",transform:"translateX(-50%)",transition:"opacity 0.3s ease"},onClick:R,children:jsxDEV(l,{},void 0,!1,void 0,this)},void 0,!1,void 0,this),jsxDEV("button",{class:"float-btn",disabled:!U,style:{position:"absolute",right:"15%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"2rem",transform:"translate(50%,-25%)",transition:"opacity 0.3s ease"},onClick:n,children:jsxDEV(h,{},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)},Qq=d;export{Qq as default};
