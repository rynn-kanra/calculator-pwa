import{a as T,b as V}from"./index-t4ts98cf.chunk.js";import"./index-ygd05jk1.chunk.js";import{ma as $,pa as X}from"./index-5ztkcgcw.chunk.js";import"./index-m6gkxxm7.chunk.js";import"./index-wtr7p5sj.chunk.js";var H=[],O=new Set,E=async()=>{let j=[];if(O.size>0)j=(await K.clients.matchAll({type:"window",includeUncontrolled:!0})).filter((z)=>O.has(z.id));return j},F=async()=>{return await(await fetch("./assets/data/version.json",{cache:"no-cache"})).json()},L=async(j,b=!1)=>{let z=await caches.open($),Q=j.app_files.map((J)=>(async()=>{let G=await fetch(J,{cache:"no-cache"});if(G.ok&&!G.redirected)await z.put(J,G.clone())})());Q.splice(Q.length,0,...j.assets.map((J)=>(async()=>{let G=await fetch(J,{cache:b?"no-cache":"default"});if(G.ok&&!G.redirected)await z.put(J,G.clone())})())),await Promise.all(Q),await X.set("version",j),await M(j)},M=async(j)=>{let b=await caches.open($),z=j.app_files.map((G)=>new URL(G,K.location.href).pathname?.toLowerCase()),J=(await b.keys()).map(async(G)=>{let W=new URL(G.url)?.pathname?.toLowerCase();if(!W.includes(".chunk.")&&!W.includes("chunk-")||z.includes(W))return;await b.delete(G)});await Promise.all(J)},y=async()=>{if((await X.get("setting")).autoUpdate==1){let b=await X.get("lastCheck");if(!b||b.getTime()+86400000<Date.now())V.pushMessage({payload:JSON.stringify({action:"UPDATE:CHECK"})}),b=new Date,await X.set("lastCheck",b);setTimeout(y,b.getTime()+86400000-Date.now())}};y();var k={BackgroundFeth:async(j,b,z,Q)=>{T.notifHandler(K,b,z,Q)},ready:async(j)=>{if(j.source instanceof Client)O.add(j.source.id)},handleShare:async(j)=>{let b=await E();if(H.length>0&&b.length>0){let z=H.splice(0,H.length);for(let Q of z)for(let J of b)J.postMessage(Q)}},"UPDATE:CHECK":async(j=!1)=>{let b=await X.get("version"),z=await F();if(b?.version!=z.version)await K.registration.showNotification("Versi baru tersedia",{body:`Printer Calculator: versi ${z.version}`,icon:"./assets/images/icon.192.png",requireInteraction:!0,data:{action:"UPDATE:INSTALL",params:[z]},actions:[{action:"cancel",title:"Cancel"},{action:"update",title:"Update"}],dir:"ltr",lang:"id-ID",silent:!1,badge:void 0,tag:void 0});else if(j)await K.registration.showNotification("Belum ada versi baru",{body:`Printer Calculator: versi ${b.version}`,icon:"./assets/images/icon.192.png",requireInteraction:!1,dir:"ltr",lang:"id-ID",silent:!1,badge:void 0,tag:void 0})},"UPDATE:INSTALL":async(j,b)=>{if(j=="cancel")return;await L(b,!0)}},N=async(j)=>{let b=j.action,z=j.params||[],Q=k[b];if(Q)await Q.call(null,...z)},K=self;K.addEventListener("install",(j)=>{j.waitUntil(F().then((b)=>L(b))),K.skipWaiting()});K.addEventListener("activate",(j)=>{j.waitUntil(caches.keys().then((b)=>Promise.all(b.map((z)=>{if(z!==$)return caches.delete(z)})))),K.clients.claim()});K.addEventListener("push",(j)=>{if(!j.data)return;let b=j.data.json();N(b)});var B;K.addEventListener("fetch",(j)=>{let b=j.request,z=new URL(b.url);if(z.pathname==="/"&&b.method==="POST"){j.respondWith((async()=>{let J=await b.formData(),G=J.get("title"),Y=J.get("text"),W=J.get("url"),I=J.get("image"),P=await E(),x={type:"SHARE",title:G,text:Y,url:W,image:I};if(P.length<=0)H.push(x);else for(let Z of P)Z.postMessage(x);return Response.redirect("./#/ocr?share=image",303)})());return}if(b.method!=="GET")return;if(!b.destination)return;if(z.origin!==self.origin)return;let Q=!1;if(z.pathname==="/index.html")Q=!0,z.pathname="/";if(z.searchParams.has("sw"))z.searchParams.delete("sw"),Q=!0;if(Q)b=new Request(z.toString(),{method:b.method,headers:b.headers,credentials:b.credentials,redirect:b.redirect,referrer:b.referrer,referrerPolicy:b.referrerPolicy,integrity:b.integrity,cache:b.cache});j.respondWith(X.get("setting").then((J)=>{if(J.autoUpdate==3)return fetch(b,{cache:"no-cache"}).then((G)=>{if(G.type=="basic"&&G.status==200){let Y=G.clone();caches.open($).then((W)=>W.put(b,Y))}return G});return caches.match(b).then(async(G)=>{let Y=void 0,W=!G;if(!W&&J.autoUpdate==0)W=(await X.get("version"))?.app_files?.some((P)=>z.pathname?.toLowerCase()==new URL(P,K.location.href).pathname?.toLowerCase())==!0;if(W){let I=new AbortController,P=setTimeout(()=>I.abort(),2000),x={signal:I.signal};if(J.autoUpdate==0){if(x.cache="no-cache",G){let Z=G.headers.get("ETag");if(Z)x.headers={"If-None-Match":Z}}}Y=fetch(b,x).then((Z)=>{if(Z.type=="basic"&&Z.status==200){let S=Z.clone();if(caches.open($).then((_)=>_.put(b,S)),G)clearTimeout(B),B=setTimeout(()=>{F().then(async(_)=>{await X.set("version",_),await M(_)})},1000)}return Z}).finally(()=>{clearTimeout(P)})}if(!G)G=await Y;return G})}))});K.addEventListener("backgroundfetchsuccess",(j)=>{j.waitUntil((async()=>{let b=await j.registration.matchAll(),z=await caches.open($),Q=b.map(async(G)=>{let Y=await G.responseReady;await z.put(G.request,Y)});await Promise.all(Q),j.updateUI({title:"download completed"});let J=await K.clients.matchAll();for(let G of J)G.postMessage({action:"DOWNLOAD",status:!0,id:j.registration.id})})())});K.addEventListener("backgroundfetchfail",async(j)=>{j.updateUI({title:"download failed"});let b=await K.clients.matchAll();for(let z of b)z.postMessage({action:"DOWNLOAD",status:!1,id:j.registration.id})});K.addEventListener("message",(j)=>{if(!j.data?.action)return;let b=j.data;b.params=b.params||[],b.params.unshift(j),N(b)});K.addEventListener("notificationclick",(j)=>{j.notification.close();let b=j.notification.data;if(!b)return;b.params=b.params||[],b.params.unshift(j.action??""),N(b)});
