function $(B,G,J,K){function N(X){return X instanceof J?X:new J(function(Y){Y(X)})}return new(J||(J=Promise))(function(X,Y){function T(U){try{Z(K.next(U))}catch(q){Y(q)}}function W(U){try{Z(K.throw(U))}catch(q){Y(q)}}function Z(U){U.done?X(U.value):N(U.value).then(T,W)}Z((K=K.apply(B,G||[])).next())})}var V=Symbol("Comlink.optionalChaining"),m=Symbol("Comlink.proxyController"),e=Symbol("Comlink.proxy"),BB=Symbol("Comlink.releaseProxy"),j=Symbol("Comlink.thrown"),u=crypto.getRandomValues(new Uint8Array(6)).reduce((B,G)=>B*256+G,0),k=new Map;function s(B){return B.constructor.name==="MessagePort"}function p(B){if(s(B))B.close()}var t=new WeakMap;function GB(B,G){return t.set(B,G),B}function b(B,G){return $(this,void 0,void 0,function*(){for(let[J,K]of k)if(K.canHandle(G)){let[N,X]=yield K.serialize(G,B);return[{type:4,name:J,value:N},X]}return[{type:1,value:G},t.get(G)||[]]})}function y(B,G){return $(this,void 0,void 0,function*(){switch(G.type){case 4:return yield k.get(G.name).deserialize(G.value,B);case 1:return G.value}})}var JB=V.toString(),KB=Symbol.asyncIterator.toString(),NB="SharedWorkerGlobalScope"in globalThis,v=Symbol("Comlink.finalizer"),_=new WeakMap,x=new WeakMap,D=new Map,O=new Map;function c(B,G=globalThis,J=["*"],K){let N=D.get(G);if(!N){if(N={proxyIdMap:new Map,callback:function(Z){return $(this,void 0,void 0,function*(){var U,q;if(!Z||!Z.data)return;if(!QB(J,Z.origin))return;let{id:L,type:w}=Z.data,A=(U=Z.data.path)!==null&&U!==void 0?U:[],l=(q=Z.data.pid)!==null&&q!==void 0?q:0,h=yield Promise.all((Z.data.argumentList||[]).map((Q)=>y(G,Q))),F;try{let Q,E,H;if(A.length===0)Q=H=N.proxyIdMap.get(l),E=void 0;else{let S=!1;Q=N.proxyIdMap.get(l);for(let I=0,P=A.length-1;I<P;I++){let C=A[I];if(!S&&(Q===null||Q===void 0))break;if(C===JB){S=!0;continue}if(Q=S?Q===null||Q===void 0?void 0:Q[C]:Q[C],S&&Q!==void 0&&Q!==null)S=!1}E=A[A.length-1],H=S?Q===null||Q===void 0?void 0:Q[E]:Q[E]}switch(w){case 1:F=H;break;case 2:Q[E]=yield y(G,Z.data.value),F=!0;break;case 3:if(E===KB){if(Symbol.asyncIterator in Q)H=Q[Symbol.asyncIterator];else H=Q[Symbol.iterator];F=c(H.apply(Q,h),G)}else F=H.apply(Q,h);break;case 4:{let S=new H(...h);F=c(S,G)}break;case-1:if(K)if(Z.data.lock)navigator.locks.request(Z.data.lock,()=>{f(G)}),clearTimeout(N.timeout),N.timeout=void 0,F=void 0;else clearTimeout(N.timeout),N.timeout=setTimeout(()=>{f(G)},K),F=Math.floor(K/3);else F=void 0;break;case 5:{let{port1:S,port2:I}=new MessageChannel;c(Q,I),F=GB(S,[S])}break;case-3:{let{tid:S}=Z.data,I=O.get(S),{proxyIdMap:P}=D.get(I);for(let[C,r]of N.proxyIdMap)if(!P.has(C))P.set(C,r);F=void 0}break;case-2:{let S=Z.data.tid;O.set(S,G),N.tid=S,F=u}break;case 9:F=void 0;break;default:return}}catch(Q){F={value:Q,[j]:0}}Promise.resolve(F).catch((Q)=>{return{value:Q,[j]:0}}).then((Q)=>$(this,void 0,void 0,function*(){if(L){let[E,H]=yield b(G,Q);E.id=L,G.postMessage(E,H)}if(w===9||w===-3)f(G)})).catch((Q)=>$(this,void 0,void 0,function*(){if(!L)return;let[E,H]=yield b(G,{value:TypeError("Unserializable return value",{cause:Q}),[j]:0});E.id=L,G.postMessage(E,H)}))})}},!NB)K=void 0;if(D.set(G,N),G.addEventListener("message",N.callback),G.start)G.start();if(!s(G)){if(K)N.timeout=setTimeout(function(){f(G)},K);G.postMessage({id:-1,type:1,value:K})}}let X=XB(B),T=o(X).pid;return N.proxyIdMap.set(T,B),X}function f(B=globalThis,G){var J;let K=D.get(B);if(!K)return;let N=K.proxyIdMap;if(G){let W=_.get(G).pid;if(N.has(W))N.delete(W);if(N.size>0)return}let{callback:X,timeout:Y,tid:T}=K;if(X&&B.removeEventListener("message",X),p(B),D.delete(B),T&&O.delete(T),typeof Y<"u"&&clearTimeout(Y),G&&v in G&&typeof G[v]==="function")G[v]();if(D.size===0)(J=globalThis.close)===null||J===void 0||J.call(globalThis)}function QB(B,G){for(let J of B){if(G===J||J==="*")return!0;if(J instanceof RegExp&&J.test(G))return!0}return!1}function XB(B){var G;if(x.has(B))return B;let J=(G=_.get(B))===null||G===void 0?void 0:G.proxy;if(!J)J=a(B)?B:new Proxy(B,{}),_.set(B,{proxy:J}),x.set(J,{obj:B});return J}var YB=0;function o(B){let G=x.get(B);if(typeof G.pid!=="number")G.pid=YB++,_.get(G.obj).pid=G.pid;return G}function a(B){return x.has(B)||(B===null||B===void 0?void 0:B[e])}var d=new WeakMap,ZB=navigator&&"locks"in navigator&&typeof navigator.locks.request==="function";class n{constructor(B){this.ep=B,this.messageIdSequence=1,this.pendingListeners=new Map,this.isReady=!1,this.queue=[],this.pidRemoteMap=new Map,this.initialize()}getRemote(B){var G,J;return(J=(G=this.pidRemoteMap.get(B))===null||G===void 0?void 0:G.remote)===null||J===void 0?void 0:J.deref()}unregister(B){let G=this.pidRemoteMap.get(B);if(G.count--,G.count===0)this.pidRemoteMap.delete(B);if(this.pidRemoteMap.size===0)this.requestResponse({type:9}).then(()=>{var J;this.ep.removeEventListener("message",this.handler.bind(this)),p(this.ep),(J=this.heartBeat)!==null&&J!==void 0||clearTimeout(this.heartBeat),this.pendingListeners.clear(),this.queue=void 0});return this.pidRemoteMap.size===0}register(B,G,J){if(d.set(B,G),!this.pidRemoteMap.has(G))this.pidRemoteMap.set(G,{remote:new WeakRef(B),count:0});let K=this.pidRemoteMap.get(G);if(J&&!K.remote.deref())K.remote=new WeakRef(B);K.count++}get(B,G){return this.requestResponse({type:1,pid:B,path:G.map((J)=>J.toString())})}set(B,G,J){return $(this,void 0,void 0,function*(){let[K,N]=yield b(this.ep,J);return yield this.requestResponse({type:2,pid:B,path:G.map((X)=>X.toString()),value:K},N)})}apply(B,G,J){return $(this,void 0,void 0,function*(){let[K,N]=yield this.processArguments(this.ep,J);return this.requestResponse({type:3,pid:B,path:G.map((X)=>X.toString()),argumentList:K},N)})}construct(B,G,J){return $(this,void 0,void 0,function*(){let[K,N]=yield this.processArguments(this.ep,J);return this.requestResponse({type:4,pid:B,path:G.map((X)=>X.toString()),argumentList:K},N)})}createEndPoint(B){return this.requestResponse({type:5,pid:B})}requestResponse(B,G){return new Promise((J)=>{var K;if(B.id=this.messageIdSequence++,this.pendingListeners.set(B.id,J),this.isReady)this.ep.postMessage(B,G);else(K=this.queue)===null||K===void 0||K.push([B,G])}).then((J)=>y(this.ep,J))}processArguments(B,G){return $(this,void 0,void 0,function*(){return(yield Promise.all(G.map((N)=>b(B,N)))).reduce((N,X)=>{if(N[0].push(X[0]),Array.isArray(X[1]))N[1].push(...X[1]);return N},[[],[]])})}initialize(){if(this.ep.addEventListener("message",this.handler.bind(this)),this.ep.start)this.ep.start();if(this.isReady=s(this.ep),this.isReady)this.queue=void 0;else this.pendingListeners.set(-1,(B)=>$(this,void 0,void 0,function*(){this.isReady=!0;let G=this.queue;if(this.queue=void 0,G)for(let K of G)this.ep.postMessage(K[0],K[1]);let J=yield y(this.ep,B);if(typeof J==="number"&&J>0)if(ZB){let K=`Comlink.id:${Date.now()}:${Math.random()*Number.MAX_SAFE_INTEGER}`;navigator.locks.request(K,{mode:"exclusive"},()=>new Promise(()=>{})),this.requestResponse({type:-1,lock:K})}else this.sendHeartBeat(J)})),this.ep.postMessage({id:-1,type:-1});this.sendTID()}handler(B){return $(this,void 0,void 0,function*(){let{data:G}=B;if(!G||!G.id)return;let J=this.pendingListeners.get(G.id);if(!J)return;try{J(G)}finally{this.pendingListeners.delete(G.id)}})}sendTID(){return $(this,void 0,void 0,function*(){let B=yield this.requestResponse({type:-2,tid:u});this.tid=B})}sendHeartBeat(B){var G;if(typeof B!=="number"||B<=0)return;(G=this.heartBeat)!==null&&G!==void 0||clearTimeout(this.heartBeat),this.heartBeat=setTimeout(()=>{this.requestResponse({type:-1}).then((J)=>this.sendHeartBeat(J))},B)}}var M="FinalizationRegistry"in globalThis&&new FinalizationRegistry(([B,G])=>B.unregister(G)),i=new Map,$B=function(){};function R(B){if(B)throw Error("Proxy has been released and is not useable")}function FB(B){let G=g(B);return z(G,0)}function g(B,G=!0){let J=i.get(B);if(G&&!J)J=new n(B),i.set(B,J);return J}function z(B,G,J=[]){let K=!1,N=new Proxy($B,{get(X,Y){if(R(K),Y===BB)return()=>{if(M)M.unregister(N);B.unregister(G),K=!0};if(Y===m)return B;if(Y==="then"){if(J.length===0)return{then:()=>N};if(J[J.length-1]===V)J=J.slice(0,-1);let T=B.get(G,J);return T.then.bind(T)}return z(B,G,[...J,Y])},set(X,Y,T){return R(K),B.set(G,[...J,Y],T)},apply(X,Y,T){R(K);let W=J[J.length-1];if(W==="bind")return z(B,G,J.slice(0,-1));if(W===Symbol.asyncIterator){let Z,U=()=>$(this,void 0,void 0,function*(){if(!Z)Z=yield B.apply(G,J,[]);return Z});return{next(q){return $(this,void 0,void 0,function*(){return(yield U()).next(q)})},return(q){return $(this,void 0,void 0,function*(){return(yield U()).return[V](q)})},throw(q){return $(this,void 0,void 0,function*(){return(yield U()).throw[V](q)})}}}return B.apply(G,J,T)},construct(X,Y){return R(K),B.construct(G,J,Y)}});if(B.register(N,G,J.length===0),M)M.register(N,[B,G],N);return N}var UB={canHandle:(B)=>{return a(B)||typeof B==="function"},serialize(B,G){return $(this,void 0,void 0,function*(){let J=o(B),K=D.get(G);if(!K.proxyIdMap.has(J.pid))K.proxyIdMap.set(J.pid,J.obj);return[J.pid,[]]})},deserialize(B,G){return $(this,void 0,void 0,function*(){var J;let K=g(G);return(J=K.getRemote(B))!==null&&J!==void 0?J:z(K,B)})}},SB={canHandle:(B)=>{return d.has(B)&&B[m]instanceof n},serialize(B,G){return $(this,void 0,void 0,function*(){let J=d.get(B),K={pid:J},N=B[m];if(N!==g(G,!1))K.mp=yield N.createEndPoint(J),K.tid=N===null||N===void 0?void 0:N.tid;return[K,[K.mp]]})},deserialize(B,G){return $(this,arguments,void 0,function*({pid:J,mp:K,tid:N},X){if(K&&N){let Y=K,T=O.get(N);if(T)yield new Promise((U,q)=>{var L;(L=K.start)===null||L===void 0||L.call(K),K.postMessage({id:-1,type:-3,tid:u}),K.onmessage=()=>{U(),K.onmessage=null,K.close()},K.onmessageerror=q}),Y=T;else O.set(N,Y);let W=g(Y),Z=z(W,J);return W.tid=N,Z}else return D.get(X).proxyIdMap.get(J)})}},TB=(B)=>typeof B==="object"&&B!==null||typeof B==="function",qB={canHandle:(B)=>TB(B)&&(j in B),serialize(B){return $(this,arguments,void 0,function*({value:G}){let J;if(G instanceof Error)J={isError:!0,value:{message:G.message,name:G.name,stack:G.stack,cause:G.cause}};else J={isError:!1,value:G};return[J,[]]})},deserialize(B){return $(this,void 0,void 0,function*(){if(B.isError)throw Object.assign(Error(B.value.message),B.value);throw B.value})}};k.set("remote",SB);k.set("proxy",UB);k.set("throw",qB);
export{e as y,GB as z,c as A,XB as B,FB as C};
