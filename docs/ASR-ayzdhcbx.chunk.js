import{b as G}from"./index-284e53d0.chunk.js";import{e as M,h as T,i as U,m as $,o as q}from"./index-h7cmj924.chunk.js";import{K as w}from"./index-rf7tqq63.chunk.js";import{V as m,W as I,X as b,Y as jsxDEV,_ as x}from"./index-pehnjj2g.chunk.js";import"./index-j86cbgms.chunk.js";import"./index-wj4h4tw5.chunk.js";var z=window.SpeechRecognition||window.webkitSpeechRecognition;class L{_recognition;_isPermissionGranted=!1;_isListening=!1;get isListening(){return this._isListening}async requestPermission(){if(this._isPermissionGranted)return;let o=await navigator.mediaDevices.getUserMedia({audio:!0});this._isPermissionGranted=o.active}recognize(o="id-ID"){if(this.isListening)throw new Error("listening");if(!this._recognition)this._recognition=new z;this._recognition.lang=o,this._recognition.interimResults=!0,this._recognition.continuous=!0,this._recognition.maxAlternatives=1;let i;return new Promise((s,a)=>{try{this._recognition.onresult=(t)=>{i=t.results},this._recognition.onerror=(t)=>{this._isListening=!1,a(t.error)},this._recognition.onnomatch=(t)=>{if(this._isListening)this._recognition?.start()},this._recognition.onend=()=>{if(this._isListening)this._recognition?.start();else{let t="";if(i)t=Array.from(i).map((e)=>e[0].transcript).join(" ");s(t)}},this._recognition.start(),this._isListening=!0}catch(t){a(t)}})}recognize2(o="id-ID"){if(this.isListening)throw new Error("listening");if(!this._recognition)this._recognition=new z;this._recognition.lang=o,this._recognition.interimResults=!1,this._recognition.continuous=!0,this._recognition.maxAlternatives=1;let i;return new Promise((a,t)=>{try{this._recognition.onresult=(e)=>{i=e.results},this._recognition.onerror=(e)=>{this._isListening=!1,t(e.error)},this._recognition.onnomatch=(e)=>{if(this._isListening)this._recognition?.start()},this._recognition.onend=()=>{if(this._isListening)this._recognition?.start();else{let e="";if(i)e=Array.from(i).map((h)=>h[0].transcript).join(" ");a(e)}},this._recognition.start(),this._isListening=!0}catch(e){t(e)}})}stop(){if(this._isListening=!1,!this._recognition)return;this._recognition.stop()}}var v=void 0;function J(){let o=b(null),[,,i]=x(),s=b(null),[a,t]=m(!1),[e,h]=m(!1),[_,R]=m(!1),l=b(!1),[u,W]=m("");I(()=>{let n,r,c,d,f,g,A=o.current.transferControlToOffscreen();return f=new Worker(new URL("./workers/AudioVisual.js",import.meta.url),{type:"module"}),f.postMessage({canvas:A},[A]),navigator.mediaDevices.getUserMedia({audio:!0}).then((P)=>{v=new L,n=new(window.AudioContext||window.webkitAudioContext),d=n.createMediaStreamSource(P),r=n.createAnalyser(),r.fftSize=512;let X=r.fftSize;c=new Uint8Array(X),d.connect(r);let F=0.02,O=(p)=>{let k=0;for(let S=0;S<p.length;S++){let C=(p[S]-128)/128;k+=C*C}return Math.sqrt(k/p.length)>F},y=!0;s.current=(p)=>{if(!p){if(typeof g!=="number")return;clearInterval(g),g=void 0;return}if(typeof g==="number")return;g=setInterval(()=>{if(r.getByteTimeDomainData(c),O(c))y=!1,f.postMessage({audioData:c});else if(!y)y=!0,f.postMessage({silence:!0})},66.66666666666667)},t(!0)}).catch((P)=>{alert("Microphone access denied or unavailable.")}),()=>{if(clearInterval(g),n)n.close();if(f)f.terminate()}},[]);let B=async()=>{if(!a)return;if(i(),e&&!_){v.stop();return}try{let n=v.recognize();h(!0),R(!1),s.current?.(!0);let r=await n;if(!r&&!l.current)return;let c=G(r);if(!c&&!l.current)return;let d=u+c+"+";if(l.current)l.current=!1,document.startViewTransition(()=>w(`/check?data=${encodeURIComponent(d)}`));else W(d)}catch(n){alert(n)}finally{s.current?.(),R(!0)}},H=()=>{if(!e)return;if(i(),l.current=!0,v.stop(),s.current?.(),h(!1),_)l.current=!1,document.startViewTransition(()=>w(`/check?data=${encodeURIComponent(u)}`))},N=()=>{i(),document.startViewTransition(()=>{w("/")})};return jsxDEV("div",{style:{height:"100dvh",width:"100dvw",position:"relative",viewTransitionName:"view-scale"},children:[jsxDEV("canvas",{ref:o,width:window.innerWidth,height:window.innerHeight/2,style:{position:"absolute",left:0,top:0,border:"none",background:"transparent",width:"100%",height:"50%"}},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"fixed",top:"40%",left:"0",width:"100%",height:"60%",fontSize:"1rem",padding:"0.5rem 1rem",textAlign:"center"},children:u},void 0,!1,void 0,this),jsxDEV("div",{style:{position:"fixed",top:"40%",left:"0",width:"100%",height:"50%",background:"linear-gradient(to top, #fff, #ffff)"}},void 0,!1,void 0,this),e&&jsxDEV("button",{class:"float-btn",style:{position:"absolute",left:"15%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"2rem",transform:"translate(-50%,-25%)",transition:"opacity 0.3s ease"},onClick:N,children:jsxDEV(q,{},void 0,!1,void 0,this)},void 0,!1,void 0,this),jsxDEV("button",{class:"float-btn",disabled:!a,style:{position:"absolute",left:"50%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"3rem",color:"#f44336",transform:"translateX(-50%)",transition:"opacity 0.3s ease"},onClick:B,children:!e?jsxDEV(M,{fill:"#f44336"},void 0,!1,void 0,this):_?jsxDEV(U,{fill:"#f44336"},void 0,!1,void 0,this):jsxDEV(T,{fill:"#f44336"},void 0,!1,void 0,this)},void 0,!1,void 0,this),e&&jsxDEV("button",{class:"float-btn",disabled:!u,style:{position:"absolute",right:"15%",top:"auto",bottom:"10px",opacity:0.5,fontSize:"2rem",color:!u?"#ccc":"#f44336",transform:"translate(50%,-25%)",transition:"opacity 0.3s ease"},onClick:H,children:jsxDEV($,{fill:!u?"#ccc":"#f44336"},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)}export{J as default};
