class a{_canvas;_input;recognizeImage(){if(!this._input)this._input=document.createElement("input"),this._input.type="file",this._input.multiple=!0,this._input.style.display="none",document.body.appendChild(this._input);return new Promise((e,t)=>{this._input.onchange=async()=>{if(!this._input?.files)return;let i=await this.recognize(this._input.files[0]);e(i)},this._input.value="",this._input.click()})}async resize(e,t=960){let i=await new Promise((l,d)=>{let s=new Image,r=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(r),l(s)},s.onerror=(p)=>{URL.revokeObjectURL(r),d(p)},s.src=r}),n=Math.min(t/i.width,t/i.height,1);if(n>=1)return e;if(!this._canvas)this._canvas=new OffscreenCanvas(0,0);return this._canvas.width=Math.round(i.width*n),this._canvas.height=Math.round(i.height*n),this._canvas.getContext("2d").drawImage(i,0,0,this._canvas.width,this._canvas.height),await this._canvas.convertToBlob({type:"image/webp",quality:0.8})}}async function u(e,t){return await import(e,t)}async function c(e,t){return(await u(e,t)).default}class h extends a{_engine;depedencies=["./workers/gutenye.js","./assets/models/paddleocr-en/det.onnx","./assets/models/paddleocr-en/rec.onnx","./assets/models/paddleocr-en/dictionary.txt"];async init(){if(this._engine)return;let e=await c("./workers/gutenye.js");this._engine=await e.create({models:{detectionPath:"./assets/models/paddleocr-en/det.onnx",recognitionPath:"./assets/models/paddleocr-en/rec.onnx",dictionaryPath:"./assets/models/paddleocr-en/dictionary.txt"},onnxOptions:{executionProviders:["webnn","webgpu","wasm"],graphOptimizationLevel:"all"}})}async recognize(e){if(!this._engine)await this.init();let t="";try{let i=await this.resize(e);return t=URL.createObjectURL(i),(await this._engine?.detect(t))?.map((o)=>o.text).join(`
`).replaceAll("\r","")||""}finally{URL.revokeObjectURL(t)}}}
export{a as I,h as J};
